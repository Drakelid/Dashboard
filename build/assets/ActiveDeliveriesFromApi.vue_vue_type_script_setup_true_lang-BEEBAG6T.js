import{J as w,Y as j,d as C,r as h,G as z,a as u,b as g,e,w as L,j as D,v as $,t as n,l as A,o as l,c as U,L as O,F as P,x as S,Z as k,y as M}from"./index-N32n9u2U.js";import{_ as B}from"./Spinner.vue_vue_type_script_setup_true_lang-Bwd-fOUY.js";const G={};async function W(a,s){return w.post(`/api/packages/${a}/pickup/`,s)}async function q(a,s){return w.post(`/api/packages/${a}/deliver/`,s)}function J(a){let s=a.trim();return s.startsWith("/")||(s="/"+s),s.endsWith("/")||(s=s+"/"),s}function R(){const a=G?.VITE_ASSIGN_ENDPOINT,s=[a?J(a):void 0,"/api/packages/assign_package/","/api/assign_package/"].filter(Boolean);return Array.from(new Set(s))}async function Y(a){const s=R();let d;for(const y of s)try{return await w.post(y,a)}catch(p){if(d=p,p?.status!==404)throw p}throw d}async function Be(a){return Y({package_id:a})}async function Ne(){try{return await w.get("/api/packages/available_packages/")}catch(a){if(a?.status===404)return(await j().catch(()=>[])||[]).map(d=>({delivery_id:d.delivery_id,uuid:null,receiver_name:void 0,receiver_phone:void 0,pickup_location:d.pickup_location||"",pickup_latitude:d.pickup_latitude,pickup_longitude:d.pickup_longitude,delivery_location:d.delivery_location||"",service:void 0,price:void 0,packages:[]}));throw a}}const Z={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30 p-4"},H={class:"w-full max-w-md rounded-xl border bg-white shadow-lg"},K={class:"space-y-1"},Q=["disabled"],X={class:"space-y-1"},ee=["disabled"],te={key:0,class:"text-sm text-red-600"},se={class:"flex justify-end gap-2 pt-2 border-t"},ae=["disabled"],ie=["disabled"],oe=C({__name:"PackageDeliveryModal",props:{open:{type:Boolean},submitting:{type:Boolean,default:!1}},emits:["update:open","confirm"],setup(a,{emit:s}){const d=a,y=s,p=h(""),f=h(""),_=h(null);z(()=>d.open,r=>{r&&(p.value="",f.value="",_.value=null)});async function m(){if(_.value=null,!p.value.trim()){_.value="Please enter who received the package.";return}y("confirm",{delivered_to:p.value.trim(),delivery_notes:f.value.trim()||void 0})}return(r,o)=>r.open?(l(),u("div",Z,[e("div",H,[o[5]||(o[5]=e("header",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-semibold"},"Deliver Package")],-1)),e("form",{class:"p-4 space-y-4",onSubmit:L(m,["prevent"])},[e("div",K,[o[3]||(o[3]=e("label",{class:"text-sm font-medium"},"Delivered To",-1)),D(e("input",{"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),disabled:r.submitting,required:"",class:"w-full h-10 px-3 rounded-lg border",placeholder:"Recipient name"},null,8,Q),[[$,p.value]])]),e("div",X,[o[4]||(o[4]=e("label",{class:"text-sm font-medium"},"Delivery Notes",-1)),D(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=b=>f.value=b),disabled:r.submitting,rows:"3",class:"w-full p-3 rounded-lg border",placeholder:"Optional notes (max 500 chars)"},null,8,ee),[[$,f.value]])]),_.value?(l(),u("p",te,n(_.value),1)):g("",!0),e("footer",se,[e("button",{type:"button",class:"h-9 px-3 rounded border bg-white hover:bg-gray-50",onClick:o[2]||(o[2]=b=>r.$emit("update:open",!1)),disabled:r.submitting},"Cancel",8,ae),e("button",{type:"submit",class:"h-9 px-3 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",disabled:r.submitting},[r.submitting?(l(),A(B,{key:0,size:"sm"})):g("",!0),e("span",null,n(r.submitting?"Delivering…":"Confirm Delivery"),1)],8,ie)])],32)])])):g("",!0)}}),ne={class:"rounded-xl border bg-white shadow-sm"},le={class:"p-4 border-b flex items-center justify-between flex-wrap gap-2"},re={class:"text-lg font-semibold"},de={key:1,class:"text-sm text-red-600"},ue={key:0,class:"p-4 space-y-3"},ce={key:0,class:"text-sm text-gray-500"},pe={class:"flex items-center justify-between"},ve={class:"flex items-center gap-2 text-sm"},ge={class:"font-medium"},me={class:"text-xs text-gray-500"},fe={class:"mt-2 grid gap-2 md:grid-cols-2 text-sm"},_e={class:"font-medium break-words"},ye={class:"font-medium break-words"},be={class:"mt-2 space-y-2"},he={class:"text-sm font-medium"},ke={class:"flex items-center gap-3 flex-wrap"},we={class:"px-2 py-0.5 rounded bg-gray-100"},xe={class:"text-gray-600"},De={key:0,class:"text-gray-500"},$e={key:0,class:"flex gap-2 flex-wrap"},Pe=["disabled","onClick"],Se=["disabled","onClick"],Fe=C({__name:"ActiveDeliveriesFromApi",props:{items:{default:()=>[]},loading:{type:Boolean,default:!1},error:{default:null},showFullView:{type:Boolean,default:!1},title:{default:"Active Deliveries"},emptyText:{default:"No active deliveries"},enableActions:{type:Boolean,default:!1}},emits:["refresh"],setup(a,{emit:s}){const d=a,y=s,p=U(()=>d.showFullView?d.items:d.items.slice(0,3)),f=["picked_up","in_transit","delivered"],_=["delivered"],m=h(!1),r=h(!1),o=h(null);function b(t){!t&&t!==0||(o.value=t,r.value=!0)}async function N(t){if(!(!t&&t!==0)){m.value=!0;try{await W(t,{success:!0,message:"Picked up",new_status:"picked_up",new_status_display:"Picked up",picked_up_at:new Date().toISOString()}),k.success("Package marked as picked up"),y("refresh")}catch(i){k.error(i?.message||"Failed to mark as picked up")}finally{m.value=!1}}}async function F(t){if(o.value!=null){m.value=!0;try{await q(o.value,t),r.value=!1,k.success("Package delivered"),y("refresh")}catch(i){k.error(i?.message||"Failed to deliver package")}finally{m.value=!1}}}function T(t){const i=(t.delivery_status||"").toLowerCase();return i?!f.includes(i):!0}function V(t){const i=(t.delivery_status||"").toLowerCase();return i?f.includes(i)&&!_.includes(i):!1}function E(t){return String(t||"").replace(/_/g," ")}return(t,i)=>(l(),u("section",ne,[e("header",le,[e("h3",re,n(t.title),1),t.loading?(l(),A(B,{key:0,size:"sm"})):t.error?(l(),u("div",de,n(t.error),1)):g("",!0)]),!t.loading&&!t.error?(l(),u("div",ue,[p.value.length===0?(l(),u("div",ce,n(t.emptyText),1)):g("",!0),(l(!0),u(P,null,S(p.value,(c,x)=>(l(),u("div",{key:(c.delivery?.id??x)+"-"+x,class:"rounded-lg border p-3 hover:shadow-sm"},[e("div",pe,[e("div",ve,[e("span",ge,"#"+n(c.delivery?.id??"—"),1),e("span",{class:M(["px-2 py-0.5 rounded text-xs",c.is_delivered?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"])},n(c.is_delivered?"Completed":"Pending"),3)]),e("div",me,n(c.date)+" "+n(c.time),1)]),e("div",fe,[e("div",null,[i[1]||(i[1]=e("div",{class:"text-gray-500"},"Pickup",-1)),e("div",_e,n(c.pickup_location||c.delivery?.pickup_location||"—"),1)]),e("div",null,[i[2]||(i[2]=e("div",{class:"text-gray-500"},"Delivery",-1)),e("div",ye,n(c.delivery?.delivery_location||"—"),1)])]),e("div",be,[e("div",he,"Packages ("+n(c.packages?.length||0)+")",1),(l(!0),u(P,null,S(c.packages,v=>(l(),u("div",{key:v.id,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 rounded border p-2 text-sm"},[e("div",ke,[e("span",we,"ID: "+n(v.id??"—"),1),e("span",xe,"Status: "+n(E(v.delivery_status)||"—"),1),v.weight?(l(),u("span",De,"• "+n(v.weight)+" "+n(v.weight_unit),1)):g("",!0)]),t.enableActions?(l(),u("div",$e,[T(v)?(l(),u("button",{key:0,class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:m.value,onClick:I=>N(v.id)}," Pick up ",8,Pe)):g("",!0),V(v)?(l(),u("button",{key:1,class:"h-8 px-3 tap-target rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",disabled:m.value,onClick:I=>b(v.id)}," Deliver ",8,Se)):g("",!0)])):g("",!0)]))),128))])]))),128))])):g("",!0),O(oe,{open:r.value,submitting:m.value,"onUpdate:open":i[0]||(i[0]=c=>r.value=c),onConfirm:F},null,8,["open","submitting"])]))}});export{Fe as _,Be as a,Ne as g};
