import{d as V,r,c as B,a as i,b as m,u as t,o as n,e,t as f,h as N,g as I,p as $,f as j,i as q,w as A,j as x,v as R,k as F,l as T,m as K,n as H,q as L}from"./index-6lVp-ZfY.js";import{_ as M}from"./Spinner.vue_vue_type_script_setup_true_lang-C3SkniMV.js";const O={key:0,class:"mt-6 rounded-lg border bg-yellow-50 text-yellow-900 p-4"},U={class:"mt-3 grid gap-2 text-sm"},Y={class:"flex justify-between"},X={class:"font-medium"},z={class:"flex justify-between"},W={class:"font-mono"},G={class:"flex justify-between"},J={class:"font-mono"},Q={class:"block max-w-full overflow-x-auto p-2 bg-yellow-100 rounded"},Z=V({__name:"DevCsrfDebug",setup(D){const g=r(!1),y=r(null),l=r(null),b=r("");function h(){const p=["csrftoken","csrf","csrf_token","XSRF-TOKEN","xsrf-token","XSRFToken","X_CSRF_TOKEN","CSRF-TOKEN"];for(const o of p)if(document.cookie.split("; ").some(w=>w.startsWith(o+"=")))return o;return null}function d(){g.value=N(),y.value=h(),l.value=I(),b.value=document.cookie}async function v(){await $().catch(()=>{}),d()}function k(){["/api/auth/csrf/","/api/csrf/","/dashboard/api/csrf/","/dashboard/api/auth/csrf/","/sanctum/csrf-cookie","/api/"].forEach(o=>window.open(o,"_blank"))}const c=B(()=>l.value?l.value.slice(0,12)+"…":"—");return d(),(p,o)=>t(!1)?(n(),i("div",O,[e("div",{class:"flex items-center justify-between"},[o[0]||(o[0]=e("h4",{class:"font-semibold"},"CSRF Debug (dev only)",-1)),e("button",{class:"h-8 px-3 rounded border bg-white hover:bg-yellow-100",onClick:d},"Refresh")]),e("div",U,[e("div",Y,[o[1]||(o[1]=e("span",null,"Has CSRF Cookie:",-1)),e("span",X,f(g.value?"Yes":"No"),1)]),e("div",z,[o[2]||(o[2]=e("span",null,"Detected Token (by name):",-1)),e("span",W,f(y.value||"—"),1)]),e("div",G,[o[3]||(o[3]=e("span",null,"Token value (first 12 chars):",-1)),e("span",J,f(c.value),1)]),e("div",null,[o[4]||(o[4]=e("span",{class:"block mb-1"},"document.cookie:",-1)),e("code",Q,f(b.value||"—"),1)])]),e("div",{class:"mt-3 flex gap-2"},[e("button",{class:"h-8 px-3 rounded border bg-white hover:bg-yellow-100",onClick:v},"Prime CSRF"),e("button",{class:"h-8 px-3 rounded border bg-white hover:bg-yellow-100",onClick:k},"Open CSRF endpoints")])])):m("",!0)}}),ee={},se={class:"max-w-md mx-auto space-y-6"},oe={class:"space-y-1"},te=["disabled"],ne={class:"space-y-1"},le=["disabled"],ae={class:"space-y-1"},ie={class:"flex items-center gap-4 text-sm"},re={class:"inline-flex items-center gap-2"},de={class:"inline-flex items-center gap-2"},ue={key:0,class:"text-xs text-gray-500"},ce={key:1,class:"text-xs text-gray-500"},pe={key:0,class:"text-sm text-red-600"},me={class:"flex items-center justify-between"},fe=["disabled"],be={key:1,class:"space-y-3 rounded-xl border bg-white p-4 shadow-sm"},ve={key:2,class:"rounded-lg border p-3 bg-yellow-50 text-sm text-yellow-900"},ke=V({__name:"LoginView",setup(D){const S=K(),g=H(),{login:y,loading:l,error:b,bootstrapFromApi:h}=j(),d=r(""),v=r(""),k=!1,c=ee?.VITE_API_KEY,p=r(!1),o=r(null),w="false".toLowerCase()==="true"||!1,a=r(w?"basic":"cookie");function _(){const C=S.query.redirect||"/";g.replace(C)}async function E(){p.value=!0,await $().catch(()=>{}),await L(),o.value?.scrollIntoView({behavior:"smooth",block:"center"})}q(async()=>{c&&(await h().catch(()=>{}),_())});async function P(){try{await y({email:d.value,password:v.value},{mode:a.value}),_()}catch{}}return(C,s)=>(n(),i("section",se,[s[11]||(s[11]=e("h2",{class:"text-2xl font-semibold"},"Sign in",-1)),t(c)?(n(),i("div",be,[s[9]||(s[9]=e("div",{class:"text-sm"},[e("p",{class:"font-medium"},"API Key mode"),e("p",{class:"text-gray-600"},"You're signed in using an API key. Redirecting…")],-1)),e("button",{class:"h-10 px-4 rounded-lg border bg-white hover:bg-gray-50",onClick:_},"Continue")])):(n(),i("form",{key:0,class:"space-y-4 rounded-xl border bg-white p-4 shadow-sm",onSubmit:A(P,["prevent"])},[e("div",oe,[s[4]||(s[4]=e("label",{class:"text-sm font-medium"},"Email",-1)),x(e("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>d.value=u),type:"email",required:"",class:"w-full h-10 px-3 rounded-lg border",placeholder:"you@example.com",disabled:t(l)},null,8,te),[[R,d.value]])]),e("div",ne,[s[5]||(s[5]=e("label",{class:"text-sm font-medium"},"Password",-1)),x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=u=>v.value=u),type:"password",required:"",class:"w-full h-10 px-3 rounded-lg border",placeholder:"••••••••",disabled:t(l)},null,8,le),[[R,v.value]])]),e("div",ae,[s[8]||(s[8]=e("label",{class:"text-sm font-medium"},"Login mode",-1)),e("div",ie,[e("label",re,[x(e("input",{type:"radio",class:"accent-green-600",value:"cookie","onUpdate:modelValue":s[2]||(s[2]=u=>a.value=u)},null,512),[[F,a.value]]),s[6]||(s[6]=e("span",null,"Cookie (Session)",-1))]),e("label",de,[x(e("input",{type:"radio",class:"accent-green-600",value:"basic","onUpdate:modelValue":s[3]||(s[3]=u=>a.value=u)},null,512),[[F,a.value]]),s[7]||(s[7]=e("span",null,"Basic",-1))])]),a.value==="cookie"?(n(),i("p",ue,"Choose Cookie for session-based login (requires CSRF). If blocked, switch to Basic.")):(n(),i("p",ce,"Basic sends Authorization header on each request (no CSRF needed)."))]),t(b)?(n(),i("p",pe,f(t(b)),1)):m("",!0),e("div",me,[e("button",{disabled:t(l),class:"h-10 px-4 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 flex items-center gap-2"},[t(l)?(n(),T(M,{key:0,size:"sm"})):m("",!0),e("span",null,f(t(l)?"Signing in…":"Sign in"),1)],8,fe),t(k)&&a.value==="cookie"?(n(),i("button",{key:0,type:"button",class:"text-xs text-gray-600 hover:underline",onClick:E},"Login help (CSRF)")):m("",!0)])],32)),p.value&&!t(c)&&a.value==="cookie"?(n(),i("div",ve,[...s[10]||(s[10]=[e("p",{class:"font-medium mb-2"},"Cookie login help",-1),e("ol",{class:"list-decimal ml-5 space-y-1"},[e("li",null,"We tried to prime CSRF for you. If it still fails, click Prime CSRF below."),e("li",null,"Ensure the panel shows “Has CSRF Cookie: Yes”."),e("li",null,"Then submit the login form again.")],-1)])])):m("",!0),e("div",{ref_key:"csrfPanel",ref:o},[t(k)&&!t(c)&&a.value==="cookie"?(n(),T(Z,{key:0})):m("",!0)],512),s[12]||(s[12]=e("p",{class:"text-sm text-gray-600"}," Don’t have an account? Contact your administrator. ",-1))]))}});export{ke as default};
