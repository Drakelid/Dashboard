import{d as T,p as U}from"./packages-BZUxwpMc.js";import{d as P,r as g,G as z,a as r,b as u,e,w as I,j as x,v as D,t as i,l as S,o as l,c as M,L as O,F as $,x as C,Y as _,y as q}from"./index-CSAjjCSR.js";import{_ as B}from"./Spinner.vue_vue_type_script_setup_true_lang-j2OFpVb6.js";const E={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30 p-4"},G={class:"w-full max-w-md rounded-xl border bg-white shadow-lg"},R={class:"space-y-1"},Y=["disabled"],H={class:"space-y-1"},J=["disabled"],K={key:0,class:"text-sm text-red-600"},Q={class:"flex justify-end gap-2 pt-2 border-t"},W=["disabled"],X=["disabled"],Z=P({__name:"PackageDeliveryModal",props:{open:{type:Boolean},submitting:{type:Boolean,default:!1}},emits:["update:open","confirm"],setup(h,{emit:w}){const b=h,y=w,p=g(""),v=g(""),m=g(null);z(()=>b.open,o=>{o&&(p.value="",v.value="",m.value=null)});async function c(){if(m.value=null,!p.value.trim()){m.value="Please enter who received the package.";return}y("confirm",{delivered_to:p.value.trim(),delivery_notes:v.value.trim()||void 0})}return(o,a)=>o.open?(l(),r("div",E,[e("div",G,[a[5]||(a[5]=e("header",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-semibold"},"Deliver Package")],-1)),e("form",{class:"p-4 space-y-4",onSubmit:I(c,["prevent"])},[e("div",R,[a[3]||(a[3]=e("label",{class:"text-sm font-medium"},"Delivered To",-1)),x(e("input",{"onUpdate:modelValue":a[0]||(a[0]=f=>p.value=f),disabled:o.submitting,required:"",class:"w-full h-10 px-3 rounded-lg border",placeholder:"Recipient name"},null,8,Y),[[D,p.value]])]),e("div",H,[a[4]||(a[4]=e("label",{class:"text-sm font-medium"},"Delivery Notes",-1)),x(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=f=>v.value=f),disabled:o.submitting,rows:"3",class:"w-full p-3 rounded-lg border",placeholder:"Optional notes (max 500 chars)"},null,8,J),[[D,v.value]])]),m.value?(l(),r("p",K,i(m.value),1)):u("",!0),e("footer",Q,[e("button",{type:"button",class:"h-9 px-3 rounded border bg-white hover:bg-gray-50",onClick:a[2]||(a[2]=f=>o.$emit("update:open",!1)),disabled:o.submitting},"Cancel",8,W),e("button",{type:"submit",class:"h-9 px-3 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",disabled:o.submitting},[o.submitting?(l(),S(B,{key:0,size:"sm"})):u("",!0),e("span",null,i(o.submitting?"Delivering…":"Confirm Delivery"),1)],8,X)])],32)])])):u("",!0)}}),ee={class:"rounded-xl border bg-white shadow-sm"},se={class:"p-4 border-b flex items-center justify-between flex-wrap gap-2"},te={class:"text-lg font-semibold"},ae={key:1,class:"text-sm text-red-600"},ie={key:0,class:"p-4 space-y-3"},le={key:0,class:"text-sm text-gray-500"},oe={class:"flex items-center justify-between"},re={class:"flex items-center gap-2 text-sm"},ne={class:"font-medium"},de={class:"text-xs text-gray-500"},ue={class:"mt-2 grid gap-2 md:grid-cols-2 text-sm"},ce={class:"font-medium break-words"},pe={class:"font-medium break-words"},ve={class:"mt-2 space-y-2"},me={class:"text-sm font-medium"},fe={class:"flex items-center gap-3 flex-wrap"},ge={class:"px-2 py-0.5 rounded bg-gray-100"},be={class:"text-gray-600"},ye={key:0,class:"text-gray-500"},_e={key:0,class:"flex gap-2 flex-wrap"},he=["disabled","onClick"],we=["disabled","onClick"],$e=P({__name:"ActiveDeliveriesFromApi",props:{items:{default:()=>[]},loading:{type:Boolean,default:!1},error:{default:null},showFullView:{type:Boolean,default:!1},title:{default:"Active Deliveries"},emptyText:{default:"No active deliveries"},enableActions:{type:Boolean,default:!1}},emits:["refresh"],setup(h,{emit:w}){const b=h,y=w,p=M(()=>b.showFullView?b.items:b.items.slice(0,3)),v=["picked_up","in_transit","delivered"],m=["delivered"],c=g(!1),o=g(!1),a=g(null);function f(s){!s&&s!==0||(a.value=s,o.value=!0)}async function F(s){if(!(!s&&s!==0)){c.value=!0;try{await U(s,{success:!0,message:"Picked up",new_status:"picked_up",new_status_display:"Picked up",picked_up_at:new Date().toISOString()}),_.success("Package marked as picked up"),y("refresh")}catch(t){_.error(t?.message||"Failed to mark as picked up")}finally{c.value=!1}}}async function V(s){if(a.value!=null){c.value=!0;try{await T(a.value,s),o.value=!1,_.success("Package delivered"),y("refresh")}catch(t){_.error(t?.message||"Failed to deliver package")}finally{c.value=!1}}}function N(s){const t=(s.delivery_status||"").toLowerCase();return t?!v.includes(t):!0}function j(s){const t=(s.delivery_status||"").toLowerCase();return t?v.includes(t)&&!m.includes(t):!1}function A(s){return String(s||"").replace(/_/g," ")}return(s,t)=>(l(),r("section",ee,[e("header",se,[e("h3",te,i(s.title),1),s.loading?(l(),S(B,{key:0,size:"sm"})):s.error?(l(),r("div",ae,i(s.error),1)):u("",!0)]),!s.loading&&!s.error?(l(),r("div",ie,[p.value.length===0?(l(),r("div",le,i(s.emptyText),1)):u("",!0),(l(!0),r($,null,C(p.value,(n,k)=>(l(),r("div",{key:(n.delivery?.id??k)+"-"+k,class:"rounded-lg border p-3 hover:shadow-sm"},[e("div",oe,[e("div",re,[e("span",ne,"#"+i(n.delivery?.id??"—"),1),e("span",{class:q(["px-2 py-0.5 rounded text-xs",n.is_delivered?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"])},i(n.is_delivered?"Completed":"Pending"),3)]),e("div",de,i(n.date)+" "+i(n.time),1)]),e("div",ue,[e("div",null,[t[1]||(t[1]=e("div",{class:"text-gray-500"},"Pickup",-1)),e("div",ce,i(n.pickup_location||n.delivery?.pickup_location||"—"),1)]),e("div",null,[t[2]||(t[2]=e("div",{class:"text-gray-500"},"Delivery",-1)),e("div",pe,i(n.delivery?.delivery_location||"—"),1)])]),e("div",ve,[e("div",me,"Packages ("+i(n.packages?.length||0)+")",1),(l(!0),r($,null,C(n.packages,d=>(l(),r("div",{key:d.id,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 rounded border p-2 text-sm"},[e("div",fe,[e("span",ge,"ID: "+i(d.id??"—"),1),e("span",be,"Status: "+i(A(d.delivery_status)||"—"),1),d.weight?(l(),r("span",ye,"• "+i(d.weight)+" "+i(d.weight_unit),1)):u("",!0)]),s.enableActions?(l(),r("div",_e,[N(d)?(l(),r("button",{key:0,class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:c.value,onClick:L=>F(d.id)}," Pick up ",8,he)):u("",!0),j(d)?(l(),r("button",{key:1,class:"h-8 px-3 tap-target rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",disabled:c.value,onClick:L=>f(d.id)}," Deliver ",8,we)):u("",!0)])):u("",!0)]))),128))])]))),128))])):u("",!0),O(Z,{open:o.value,submitting:c.value,"onUpdate:open":t[0]||(t[0]=n=>o.value=n),onConfirm:V},null,8,["open","submitting"])]))}});export{$e as _};
