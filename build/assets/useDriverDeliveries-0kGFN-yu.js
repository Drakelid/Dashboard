import{G as S,d as V,r as v,A as I,c as d,b as g,a as e,g as U,w as P,v as C,t,f as A,o as l,J as M,H as O,F as B,l as F,P as k,n as L}from"./index-Cp0ke4Zo.js";import{_ as N}from"./Spinner.vue_vue_type_script_setup_true_lang-BuBg_F9-.js";import{l as q}from"./driver-ByB8mxg_.js";async function E(u,i){return S.post(`/api/packages/${u}/pickup/`,i)}async function G(u,i){return S.post(`/api/packages/${u}/deliver/`,i)}const H={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30 p-4"},J={class:"w-full max-w-md rounded-xl border bg-white shadow-lg"},R={class:"space-y-1"},K=["disabled"],Q={class:"space-y-1"},W=["disabled"],X={key:0,class:"text-sm text-red-600"},Y={class:"flex justify-end gap-2 pt-2 border-t"},Z=["disabled"],ee=["disabled"],se=V({__name:"PackageDeliveryModal",props:{open:{type:Boolean},submitting:{type:Boolean,default:!1}},emits:["update:open","confirm"],setup(u,{emit:i}){const b=u,_=i,m=v(""),n=v(""),c=v(null);I(()=>b.open,r=>{r&&(m.value="",n.value="",c.value=null)});async function h(){if(c.value=null,!m.value.trim()){c.value="Please enter who received the package.";return}_("confirm",{delivered_to:m.value.trim(),delivery_notes:n.value.trim()||void 0})}return(r,a)=>r.open?(l(),d("div",H,[e("div",J,[a[5]||(a[5]=e("header",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-semibold"},"Deliver Package")],-1)),e("form",{class:"p-4 space-y-4",onSubmit:U(h,["prevent"])},[e("div",R,[a[3]||(a[3]=e("label",{class:"text-sm font-medium"},"Delivered To",-1)),P(e("input",{"onUpdate:modelValue":a[0]||(a[0]=y=>m.value=y),disabled:r.submitting,required:"",class:"w-full h-10 px-3 rounded-lg border",placeholder:"Recipient name"},null,8,K),[[C,m.value]])]),e("div",Q,[a[4]||(a[4]=e("label",{class:"text-sm font-medium"},"Delivery Notes",-1)),P(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=y=>n.value=y),disabled:r.submitting,rows:"3",class:"w-full p-3 rounded-lg border",placeholder:"Optional notes (max 500 chars)"},null,8,W),[[C,n.value]])]),c.value?(l(),d("p",X,t(c.value),1)):g("",!0),e("footer",Y,[e("button",{type:"button",class:"h-9 px-3 rounded border bg-white hover:bg-gray-50",onClick:a[2]||(a[2]=y=>r.$emit("update:open",!1)),disabled:r.submitting},"Cancel",8,Z),e("button",{type:"submit",class:"h-9 px-3 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",disabled:r.submitting},[r.submitting?(l(),A(N,{key:0,size:"sm"})):g("",!0),e("span",null,t(r.submitting?"Delivering…":"Confirm Delivery"),1)],8,ee)])],32)])])):g("",!0)}}),te={class:"rounded-xl border bg-white shadow-sm"},ae={class:"p-4 border-b flex items-center justify-between"},le={class:"text-lg font-semibold"},ie={key:1,class:"text-sm text-red-600"},oe={key:0,class:"p-4 space-y-3"},ne={key:0,class:"text-sm text-gray-500"},re={class:"flex items-center justify-between"},de={class:"flex items-center gap-2 text-sm"},ue={class:"font-medium"},ce={class:"text-xs text-gray-500"},pe={class:"mt-2 grid gap-2 md:grid-cols-2 text-sm"},ve={class:"font-medium"},me={class:"font-medium"},fe={class:"mt-2 space-y-2"},ge={class:"text-sm font-medium"},ye={class:"flex items-center gap-3"},be={class:"px-2 py-0.5 rounded bg-gray-100"},he={class:"text-gray-600"},_e={key:0,class:"text-gray-500"},ke={key:0,class:"flex gap-2"},we=["disabled","onClick"],xe=["disabled","onClick"],Ce=V({__name:"ActiveDeliveriesFromApi",props:{items:{default:()=>[]},loading:{type:Boolean,default:!1},error:{default:null},showFullView:{type:Boolean,default:!1},title:{default:"Active Deliveries"},emptyText:{default:"No active deliveries"},enableActions:{type:Boolean,default:!1}},emits:["refresh"],setup(u,{emit:i}){const b=u,_=i,m=M(()=>b.showFullView?b.items:b.items.slice(0,3)),n=v(!1),c=v(!1),h=v(null);function r(s){!s&&s!==0||(h.value=s,c.value=!0)}async function a(s){if(!(!s&&s!==0)){n.value=!0;try{await E(s,{success:!0,message:"Picked up",new_status:"picked_up",new_status_display:"Picked up",picked_up_at:new Date().toISOString()}),k.success("Package marked as picked up"),_("refresh")}catch(p){k.error(p?.message||"Failed to mark as picked up")}finally{n.value=!1}}}async function y(s){if(h.value!=null){n.value=!0;try{await G(h.value,s),c.value=!1,k.success("Package delivered"),_("refresh")}catch(p){k.error(p?.message||"Failed to deliver package")}finally{n.value=!1}}}return(s,p)=>(l(),d("section",te,[e("header",ae,[e("h3",le,t(s.title),1),s.loading?(l(),A(N,{key:0,size:"sm"})):s.error?(l(),d("div",ie,t(s.error),1)):g("",!0)]),!s.loading&&!s.error?(l(),d("div",oe,[m.value.length===0?(l(),d("div",ne,t(s.emptyText),1)):g("",!0),(l(!0),d(B,null,F(m.value,(o,$)=>(l(),d("div",{key:(o.delivery?.id??$)+"-"+$,class:"rounded-lg border p-3 hover:shadow-sm"},[e("div",re,[e("div",de,[e("span",ue,"#"+t(o.delivery?.id??"—"),1),e("span",{class:L(["px-2 py-0.5 rounded text-xs",o.is_delivered?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"])},t(o.is_delivered?"Completed":"Pending"),3)]),e("div",ce,t(o.date)+" "+t(o.time),1)]),e("div",pe,[e("div",null,[p[1]||(p[1]=e("div",{class:"text-gray-500"},"Pickup",-1)),e("div",ve,t(o.pickup_location||o.delivery?.pickup_location||"—"),1)]),e("div",null,[p[2]||(p[2]=e("div",{class:"text-gray-500"},"Delivery",-1)),e("div",me,t(o.delivery?.delivery_location||"—"),1)])]),e("div",fe,[e("div",ge,"Packages ("+t(o.packages?.length||0)+")",1),(l(!0),d(B,null,F(o.packages,f=>(l(),d("div",{key:f.id,class:"flex items-center justify-between rounded border p-2 text-sm"},[e("div",ye,[e("span",be,"ID: "+t(f.id??"—"),1),e("span",he,"Status: "+t(f.delivery_status??"—"),1),f.weight?(l(),d("span",_e,"• "+t(f.weight)+" "+t(f.weight_unit),1)):g("",!0)]),s.enableActions?(l(),d("div",ke,[e("button",{class:"h-8 px-3 rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:n.value,onClick:z=>a(f.id)},"Pick up",8,we),e("button",{class:"h-8 px-3 rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",disabled:n.value,onClick:z=>r(f.id)},"Deliver",8,xe)])):g("",!0)]))),128))])]))),128))])):g("",!0),O(se,{open:c.value,submitting:n.value,"onUpdate:open":p[0]||(p[0]=o=>c.value=o),onConfirm:y},null,8,["open","submitting"])]))}}),T=v(null),j=v(null),x=v(!1),D=v(null);async function w(u){x.value=!0,D.value=null;try{const i=await q(u);u==="future"?T.value=i:j.value=i}catch(i){throw D.value=i?.message||"Failed to load deliveries",i}finally{x.value=!1}}function Be(){return{future:T,past:j,loading:x,error:D,loadFuture:()=>w("future"),loadPast:()=>w("past"),refresh:async()=>{await Promise.allSettled([w("future"),w("past")])}}}export{Ce as _,Be as u};
