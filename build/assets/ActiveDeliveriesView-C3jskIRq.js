import{s as Je,d as Ke,c as v,a as u,P as at,e as t,b as y,u as q,F as Ne,t as c,o as d,r as V,G as Me,E as _e,l as je,y as Ae,M as Se,L as H,T as lt,Q as it,x as Re,R as ot,S as ze,K as rt,i as dt,U as $e,V as ut,j as ct,v as vt,W as be,w as Ge}from"./index-_kUDzXe0.js";import{_ as mt,g as pt,a as Be}from"./ActiveDeliveriesFromApi.vue_vue_type_script_setup_true_lang-BxW0a-Q0.js";import{X as We}from"./x-B4trfgyT.js";import{C as Ue,g as He,S as ft}from"./geocode-NxvTdCoX.js";import"./Spinner.vue_vue_type_script_setup_true_lang-C-UEXdmC.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=Je("alarm-clock",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M12 9v4l2 2",key:"1c63tq"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Je("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),yt=["viewBox"],xt=["id"],bt=["stop-color"],_t=["stop-color"],kt=["stop-color"],wt=["id"],$t=["stop-color"],Mt=["stop-color"],St=["stop-color"],Nt=["id"],Ct=["stop-color"],Lt=["stop-color"],It=["stop-color"],Pt=["id"],zt=["id"],qt=["d","fill","filter"],Ft=["d","fill","stroke"],At=["d","fill","stroke"],Rt=["d","fill","stroke"],Dt={stroke:"rgba(255,255,255,0.4)","stroke-width":"1.2","stroke-linecap":"round",fill:"none"},Kt=["x1","y1","x2","y2"],Et=["x1","y1","x2","y2"],Tt=["x1","y1","x2","y2"],Vt=["x1","y1","x2","y2"],jt=["x1","y1","x2","y2"],Gt=["x1","y1","x2","y2"],Bt=["x","y"],Wt=["x","y","transform"],Ut=["y","transform"],qe=.70710678,Fe=.70710678,ge=6,Ht=.2,Oe=Ke({__name:"IsometricPackageBox",props:{dimensions:{},weight:{},showDimensions:{type:Boolean,default:!0},size:{default:"medium"},scaleMode:{default:"normalized"},fitReference:{}},setup(Z){const b=Z,_=Math.random().toString(36).slice(2,9),R={small:{baseSize:60,iconSize:12,textSize:"text-xs",minSize:20},medium:{baseSize:80,iconSize:16,textSize:"text-sm",minSize:25},large:{baseSize:120,iconSize:20,textSize:"text-base",minSize:30}},K=v(()=>R[b.size]),D=v(()=>Math.max(b.dimensions.length,b.dimensions.width,b.dimensions.height));v(()=>b.dimensions.length/(D.value||1)),v(()=>b.dimensions.width/(D.value||1)),v(()=>b.dimensions.height/(D.value||1));const N=v(()=>{if(b.scaleMode==="absolute"){const g=b.fitReference??b.dimensions,$=qe,F=Fe,L=g.width,x=g.length,A=g.height,W=8,X=8,re=(100-W)/Math.max(1,L+x*$),de=(90-X)/Math.max(1,A+x*F);return Math.max(.2,Math.min(re,de))}return K.value.baseSize/(D.value||1)}),m=v(()=>Math.max(1,b.dimensions.width*N.value)),E=v(()=>Math.max(1,b.dimensions.length*N.value)),r=v(()=>Math.max(1,b.dimensions.height*N.value)),C=v(()=>E.value*qe),z=v(()=>E.value*Fe),Q=v(()=>Math.min(6,Math.max(.5,Math.min(m.value,r.value)*.06))),ee=v(()=>Math.min(6,Math.max(.5,Math.min(C.value,r.value)*.06))),te=v(()=>Math.min(6,Math.max(.5,Math.min(m.value,C.value)*.06))),B=v(()=>[{x:h.value+0,y:w.value+k.value+r.value},{x:h.value+m.value,y:w.value+k.value+r.value},{x:h.value+m.value,y:w.value+k.value+0},{x:h.value+0,y:w.value+k.value+0}]),ae=v(()=>[{x:h.value+m.value,y:w.value+k.value+r.value},{x:h.value+m.value+C.value,y:w.value+k.value+(r.value-z.value)},{x:h.value+m.value+C.value,y:w.value+k.value+-z.value},{x:h.value+m.value,y:w.value+k.value+0}]),le=v(()=>[{x:h.value+0,y:w.value+k.value+0},{x:h.value+m.value,y:w.value+k.value+0},{x:h.value+m.value+C.value,y:w.value+k.value+-z.value},{x:h.value+C.value,y:w.value+k.value+-z.value}]),ye=v(()=>[{x:h.value+(0+.3*r.value),y:w.value+k.value+(r.value+ge)},{x:h.value+(m.value+.3*r.value),y:w.value+k.value+(r.value+ge)},{x:h.value+(m.value+C.value+.3*r.value),y:w.value+k.value+(r.value-z.value+ge)},{x:h.value+(C.value+.3*r.value),y:w.value+k.value+(r.value-z.value+ge)}]),O=v(()=>b.scaleMode==="absolute"?100:K.value.baseSize*(1+qe)+20),ie=v(()=>b.scaleMode==="absolute"?90:K.value.baseSize*(1+Fe)+ge+20),J=v(()=>m.value+C.value),oe=v(()=>r.value+z.value+ge),h=v(()=>(O.value-J.value)/2),k=v(()=>z.value),w=v(()=>(ie.value-oe.value)/2),a=v(()=>`0 0 ${O.value} ${ie.value}`),i=v(()=>{const{length:g,width:$,height:F}=b.dimensions,L=F<Math.min(g,$)*.3,x=F>Math.max(g,$)*1.5,A=Math.abs(g-$)<Math.max(g,$)*.2;return L?"flat":x?"tall":A?"square":"rectangular"}),o=v(()=>{switch(i.value){case"flat":return{front:{start:"#fff8e1",middle:"#ffeb3b",end:"#ff8f00"},right:{start:"#ff8f00",middle:"#f57c00",end:"#e65100"},top:{start:"#fff9c4",middle:"#ffeb3b",end:"#ffa000"},stroke:"#e65100"};case"tall":return{front:{start:"#e8f5e8",middle:"#66bb6a",end:"#2e7d32"},right:{start:"#2e7d32",middle:"#1b5e20",end:"#0d3818"},top:{start:"#f1f8e9",middle:"#8bc34a",end:"#689f38"},stroke:"#1b5e20"};case"square":return{front:{start:"#fce4ec",middle:"#e91e63",end:"#ad1457"},right:{start:"#ad1457",middle:"#880e4f",end:"#4a0e4e"},top:{start:"#f8bbd9",middle:"#e91e63",end:"#c2185b"},stroke:"#880e4f"};default:return{front:{start:"#e3f2fd",middle:"#42a5f5",end:"#1565c0"},right:{start:"#1565c0",middle:"#0d47a1",end:"#002171"},top:{start:"#f3e5f5",middle:"#ba68c8",end:"#7b1fa2"},stroke:"#0d47a1"}}});function I(g,$=3){if(!g||g.length<3)return"";let F="";for(let L=0;L<g.length;L++){const x=g[L],A=g[(L+1)%g.length],W=g[(L-1+g.length)%g.length];if(L===0){const fe=x.x-W.x,he=x.y-W.y,ue=Math.hypot(fe,he);if(ue>$*2){const ce=fe/ue,ve=he/ue;F+=`M ${x.x-ce*$} ${x.y-ve*$}`}else F+=`M ${x.x} ${x.y}`}const X=x.x-W.x,re=x.y-W.y,de=A.x-x.x,pe=A.y-x.y,Y=Math.hypot(X,re),se=Math.hypot(de,pe);if(Y>0&&se>0){const fe=X/Y,he=re/Y,ue=de/se,ce=pe/se,ve=Math.min($,Y/2,se/2),Ce=x.x-fe*ve,me=x.y-he*ve,Le=x.x+ue*ve,Ie=x.y+ce*ve;F+=` L ${Ce} ${me}`,F+=` Q ${x.x} ${x.y} ${Le} ${Ie}`}else F+=` L ${x.x} ${x.y}`}return F+=" Z",F}return(g,$)=>(d(),u("svg",at(g.$attrs,{viewBox:a.value,preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",class:"block"}),[t("defs",null,[t("linearGradient",{id:`frontGradient-${q(_)}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[t("stop",{offset:"0%","stop-color":o.value.front.start},null,8,bt),t("stop",{offset:"50%","stop-color":o.value.front.middle},null,8,_t),t("stop",{offset:"100%","stop-color":o.value.front.end},null,8,kt)],8,xt),t("linearGradient",{id:`rightGradient-${q(_)}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[t("stop",{offset:"0%","stop-color":o.value.right.start},null,8,$t),t("stop",{offset:"50%","stop-color":o.value.right.middle},null,8,Mt),t("stop",{offset:"100%","stop-color":o.value.right.end},null,8,St)],8,wt),t("linearGradient",{id:`topGradient-${q(_)}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[t("stop",{offset:"0%","stop-color":o.value.top.start},null,8,Ct),t("stop",{offset:"50%","stop-color":o.value.top.middle},null,8,Lt),t("stop",{offset:"100%","stop-color":o.value.top.end},null,8,It)],8,Nt),t("linearGradient",{id:`shadowGradient-${q(_)}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[...$[0]||($[0]=[t("stop",{offset:"0%","stop-color":"rgba(0,0,0,0.25)"},null,-1),t("stop",{offset:"50%","stop-color":"rgba(0,0,0,0.15)"},null,-1),t("stop",{offset:"100%","stop-color":"rgba(0,0,0,0.05)"},null,-1)])],8,Pt),t("filter",{id:`shadowBlur-${q(_)}`,x:"-50%",y:"-50%",width:"200%",height:"200%"},[...$[1]||($[1]=[t("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2"},null,-1)])],8,zt)]),t("path",{d:I(ye.value,2),fill:`url(#shadowGradient-${q(_)})`,filter:`url(#shadowBlur-${q(_)})`,opacity:Ht},null,8,qt),t("path",{d:I(B.value,Q.value),fill:`url(#frontGradient-${q(_)})`,stroke:o.value.stroke,"stroke-width":"1.2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ft),t("path",{d:I(ae.value,ee.value),fill:`url(#rightGradient-${q(_)})`,stroke:o.value.stroke,"stroke-width":"1.2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,At),t("path",{d:I(le.value,te.value),fill:`url(#topGradient-${q(_)})`,stroke:o.value.stroke,"stroke-width":"1.2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Rt),t("g",Dt,[t("line",{x1:h.value,y1:w.value+k.value,x2:h.value+m.value,y2:w.value+k.value},null,8,Kt),t("line",{x1:h.value+m.value,y1:w.value+k.value,x2:h.value+m.value+C.value,y2:w.value+k.value-z.value},null,8,Et),t("line",{x1:h.value,y1:w.value+k.value,x2:h.value+C.value,y2:w.value+k.value-z.value},null,8,Tt),t("line",{x1:h.value,y1:w.value+k.value,x2:h.value,y2:w.value+k.value+r.value},null,8,Vt),t("line",{x1:h.value+m.value,y1:w.value+k.value,x2:h.value+m.value,y2:w.value+k.value+r.value},null,8,jt),t("line",{x1:h.value+m.value+C.value,y1:w.value+k.value-z.value,x2:h.value+m.value+C.value,y2:w.value+k.value+(r.value-z.value)},null,8,Gt)]),g.showDimensions?(d(),u(Ne,{key:0},[t("text",{x:m.value/2,y:r.value+15,"text-anchor":"middle",class:"fill-gray-700",style:{font:"600 10px system-ui"}},c(g.dimensions.length)+"cm ",9,Bt),t("text",{x:m.value+C.value/2,y:r.value-z.value/2+5,"text-anchor":"middle",class:"fill-gray-700",style:{font:"600 10px system-ui"},transform:`rotate(-25 ${m.value+C.value/2} ${r.value-z.value/2+5})`},c(g.dimensions.width)+"cm ",9,Wt),t("text",{x:-15,y:r.value/2,"text-anchor":"middle",class:"fill-gray-700",style:{font:"600 10px system-ui"},transform:`rotate(-90 -15 ${r.value/2})`},c(g.dimensions.height)+"cm ",9,Ut)],64)):y("",!0)],16,yt))}}),Ot={key:0,class:"fixed inset-0 z-[2147483647]"},Jt={class:"absolute inset-0 flex items-stretch md:items-center justify-center p-0 md:p-4 z-[2147483647]"},Yt={class:"w-full h-full md:w-[380px] md:h-auto rounded-none md:rounded-2xl bg-white shadow-2xl ring-1 ring-black/5 overflow-hidden z-[2147483647] grid grid-rows-[auto_1fr_auto]",role:"dialog","aria-modal":"true","aria-label":"New Pickup Request"},Qt={class:"sticky top-0 md:static relative px-4 pt-4 pb-3 bg-white/95 backdrop-blur border-b md:border-b-0",style:{"padding-top":"max(env(safe-area-inset-top), 1rem)","padding-right":"calc(max(env(safe-area-inset-right), 0.5rem) + 48px)"}},Xt={class:"flex items-start justify-between"},Zt={class:"flex items-center gap-2"},es={key:0,class:"mt-1 text-xs text-gray-700"},ts={class:"font-semibold"},ss={class:"px-4 pb-4 space-y-4 overflow-y-auto min-h-0"},ns={class:"relative"},as={class:"grid grid-cols-2 items-start gap-x-3 gap-y-0.5"},ls={class:"flex items-center gap-1.5 text-blue-600 font-medium text-xs"},is={class:"flex items-center justify-end gap-1.5 text-green-600 font-medium text-xs text-right"},os=["title"],rs=["title"],ds=["title"],us=["title"],cs={class:"pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300"},vs={key:0,class:"grid grid-cols-2 gap-4"},ms={key:0,class:"text-center"},ps={class:"text-2xl font-bold text-blue-600"},fs={key:1,class:"text-center"},hs={class:"text-2xl font-bold text-purple-600"},gs={key:1,class:"border rounded-lg p-3 bg-gray-50"},ys={class:"font-semibold text-sm mb-2"},xs={class:"space-y-2"},bs={class:"order-1 flex-1 min-w-0 text-left"},_s={class:"font-medium text-gray-800"},ks={key:0,class:"text-gray-500"},ws={class:"mt-1 flex flex-wrap gap-2"},$s={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-100 text-gray-700"},Ms={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-100 text-gray-700"},Ss={key:2,class:"inline-flex items-center px-2 py-0.5 rounded bg-amber-100 text-amber-800"},Ns={key:3,class:"inline-flex items-center px-2 py-0.5 rounded bg-red-100 text-red-800"},Cs={key:4,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-blue-50 text-blue-700"},Ls={key:5,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-purple-50 text-purple-700"},Is={key:6,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-green-50 text-green-700"},Ps={class:"order-2 h-16 w-[100px] flex-none flex items-center justify-center"},zs={key:2,class:"border rounded-lg p-3 flex flex-row items-center gap-4 bg-gray-50"},qs={class:"order-1 flex-1 min-w-0 text-left"},Fs={key:0,class:"text-xs text-gray-600"},As={key:1,class:"text-xs text-gray-500 mt-0.5"},Rs={key:0,class:"order-2 h-16 w-[100px] flex-none rounded-md relative overflow-hidden bg-gradient-to-br from-indigo-50 to-purple-100 border border-indigo-200"},Ds={key:1,class:"order-2 h-6 w-6 flex-none rounded-full border border-gray-200 grid place-items-center text-gray-400","aria-hidden":"true"},Ks={class:"text-center"},Es={class:"flex items-center justify-center gap-1.5 text-red-600"},Ts={class:"font-semibold text-sm"},Vs={key:3,class:"rounded-lg bg-green-50 px-3 py-3 text-center border border-green-100"},js={class:"text-2xl font-bold text-green-700"},Gs={class:"px-4 pb-4 pt-2 flex items-center gap-2 border-t md:border-t-0",style:{"padding-bottom":"calc(env(safe-area-inset-bottom) + 1rem)"}},Bs=["disabled"],Ws=["disabled"],Us=Ke({__name:"NewPickupRequestModal",props:{modelValue:{type:Boolean},request:{},deliveryId:{},packages:{}},emits:["update:modelValue","accept","decline","expired","accept-all","close"],setup(Z,{emit:b}){const _=Z,R=b,K=V(0),D=v(()=>K.value<=0),N=v(()=>{const a=Math.max(0,K.value),i=Math.floor(a/60),o=a%60;return`${i}:${o.toString().padStart(2,"0")}`});v(()=>{const a=_.request.expiresInSeconds||1,i=Math.max(0,K.value);return Math.min(100,Math.max(0,i/a*100))});let m;function E(a){K.value=a,r(),m=window.setInterval(()=>{K.value-=1,K.value<=0&&(r(),R("expired",_.request))},1e3)}function r(){m&&(clearInterval(m),m=void 0)}Me(()=>_.modelValue,a=>{if(a){E(_.request.expiresInSeconds);try{document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open")}catch{}}else{r();try{document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open")}catch{}}},{immediate:!0}),_e(()=>{r();try{document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open")}catch{}});function C(){R("update:modelValue",!1),R("close")}function z(){R("accept",_.request),R("update:modelValue",!1)}function Q(){R("decline",_.request),R("update:modelValue",!1)}function ee(){_.deliveryId!=null&&(R("accept-all",_.deliveryId),R("update:modelValue",!1))}const te=v(()=>{switch(_.request.priority){case"urgent":return"bg-red-50 text-red-700 border border-red-100";case"express":return"bg-orange-50 text-orange-700 border border-orange-100";default:return"bg-blue-50 text-blue-700 border border-blue-100"}}),B=v(()=>{switch(_.request.priority){case"urgent":return"bg-red-500";case"express":return"bg-orange-500";default:return"bg-blue-500"}}),ae=v(()=>{const i=String(_.request.dimensions||"20x15x10 cm").trim().replace(/,(?=\d)/g,"."),o=/(\d+(?:\.\d+)?)\s*(cm|mm|m|in|inch|inches)?\s*[x×]\s*(\d+(?:\.\d+)?)\s*(cm|mm|m|in|inch|inches)?\s*[x×]\s*(\d+(?:\.\d+)?)\s*(cm|mm|m|in|inch|inches)?/i,I=i.match(o);if(I){const g=parseFloat(I[1]),$=(I[2]||"").toLowerCase(),F=parseFloat(I[3]),L=(I[4]||"").toLowerCase(),x=parseFloat(I[5]),A=(I[6]||"").toLowerCase(),W=(Y,se)=>{switch(se){case"mm":return Y/10;case"m":return Y*100;case"in":case"inch":case"inches":return Y*2.54;case"cm":default:return Y}},X=A||L||$||"cm",re=W(g,$||X),de=W(F,L||X),pe=W(x,A||X);return{length:re,width:de,height:pe}}return{length:20,width:15,height:10}}),le=v(()=>ae.value);function ye(){const a=le.value,i=Math.max(a.length,a.width,a.height);return i<=35?"small":i<=70?"medium":"large"}const O=v(()=>{const a=_.packages||[];let i=1,o=1,I=1,g=!1;for(const F of a)if(ie(F)){const L=h(F);i=Math.max(i,L.length),o=Math.max(o,L.width),I=Math.max(I,L.height),g=!0}if(g)return{length:i,width:o,height:I};const $=le.value;return{length:$.length,width:$.width,height:$.height}});function ie(a){return a&&a.length!=null&&a.width!=null&&a.height!=null&&!isNaN(J(a.length))&&!isNaN(J(a.width))&&!isNaN(J(a.height))}function J(a){if(typeof a=="number")return a;if(typeof a=="string"){const i=a.replace(/,(?=\d)/g,".").trim(),o=parseFloat(i);return Number.isFinite(o)?o:NaN}return NaN}function oe(a,i){switch((i||"").toLowerCase()){case"mm":return a/10;case"m":return a*100;case"in":case"inch":case"inches":return a*2.54;case"cm":default:return a}}function h(a){const i=(a?.dimension_unit||"").toString(),o=J(a?.length),I=J(a?.width),g=J(a?.height);if(Number.isFinite(o)&&Number.isFinite(I)&&Number.isFinite(g))return{length:Math.max(1,oe(o,i)),width:Math.max(1,oe(I,i)),height:Math.max(1,oe(g,i))};const $=ae.value;return{length:$.length,width:$.width,height:$.height}}function k(a){const i=h(a),o=Math.max(i.length,i.width,i.height);return o<=35?"small":o<=70?"medium":"large"}function w(a){return String(a||"").replace(/_/g," ")}return(a,i)=>(d(),je(ot,{to:"body"},[a.modelValue?(d(),u("div",Ot,[t("div",{class:"absolute inset-0 bg-black/40 z-[2147483646]",onClick:C}),t("div",Jt,[t("section",Yt,[t("header",Qt,[t("div",Xt,[i[0]||(i[0]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"h-2 w-2 rounded-full bg-blue-500"}),t("h3",{class:"text-base font-semibold"},"New Pickup Request")],-1)),t("div",Zt,[t("span",{class:Ae(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium border",te.value])},[t("span",{class:Ae(["h-1 w-1 rounded-full",B.value])},null,2),Se(" "+c(a.request.priority),1)],2)])]),t("button",{class:"absolute z-10 tap-target grid place-items-center rounded-full hover:bg-gray-50","aria-label":"Close",onClick:C,style:{top:"max(env(safe-area-inset-top), 0.5rem)",right:"max(env(safe-area-inset-right), 0.5rem)",width:"44px",height:"44px"}},[H(q(We),{class:"w-6 h-6"})]),i[2]||(i[2]=t("p",{class:"text-xs text-gray-500 mt-1"},"A new delivery opportunity is available in your area",-1)),a.deliveryId!=null?(d(),u("div",es,[i[1]||(i[1]=Se(" Delivery ",-1)),t("span",ts,"#"+c(a.deliveryId),1)])):y("",!0)]),t("div",ss,[t("div",ns,[t("div",as,[t("div",ls,[H(q(lt),{class:"w-3.5 h-3.5"}),i[3]||(i[3]=t("span",null,"Pickup from:",-1))]),t("div",is,[i[4]||(i[4]=t("span",null,"Deliver to:",-1)),H(q(it),{class:"w-3.5 h-3.5"})]),t("div",{class:"font-semibold text-sm truncate min-w-0",title:a.request.pickup.name},c(a.request.pickup.name),9,os),t("div",{class:"font-semibold text-sm truncate min-w-0 text-right",title:a.request.dropoff.name},c(a.request.dropoff.name),9,rs),t("div",{class:"text-xs text-gray-500 truncate min-w-0",title:a.request.pickup.address},c(a.request.pickup.address),9,ds),t("div",{class:"text-xs text-gray-500 truncate min-w-0 text-right",title:a.request.dropoff.address},c(a.request.dropoff.address),9,us)]),t("div",cs,[H(q(gt),{class:"w-3.5 h-3.5"})])]),(a.request.etaMinutes||0)>0||(a.request.distanceKm||0)>0?(d(),u("div",vs,[(a.request.etaMinutes||0)>0?(d(),u("div",ms,[t("div",ps,c(a.request.etaMinutes)+" min",1),i[5]||(i[5]=t("div",{class:"text-xs text-gray-500"},"Estimated Time",-1))])):y("",!0),(a.request.distanceKm||0)>0?(d(),u("div",fs,[t("div",hs,c(a.request.distanceKm.toFixed(1))+" km",1),i[6]||(i[6]=t("div",{class:"text-xs text-gray-500"},"Distance",-1))])):y("",!0)])):y("",!0),a.packages&&a.packages.length?(d(),u("div",gs,[t("div",ys,"Packages ("+c(a.packages.length)+")",1),t("ul",xs,[(d(!0),u(Ne,null,Re(a.packages,o=>(d(),u("li",{key:o.id,class:"text-xs flex flex-nowrap items-start gap-3"},[t("div",bs,[t("div",_s,[Se("#"+c(o.id),1),o.description?(d(),u("span",ks," — "+c(o.description),1)):y("",!0)]),t("div",ws,[o.weight!=null?(d(),u("span",$s,[i[7]||(i[7]=t("span",{class:"font-medium"},"Weight:",-1)),t("span",null,c(o.weight)+c(o.weight_unit||""),1)])):y("",!0),o.length!=null&&o.width!=null&&o.height!=null?(d(),u("span",Ms,[i[8]||(i[8]=t("span",{class:"font-medium"},"Size:",-1)),t("span",null,c(o.length)+" × "+c(o.width)+" × "+c(o.height)+" "+c(o.dimension_unit||""),1)])):y("",!0),o.fragile?(d(),u("span",Ss,"Fragile")):y("",!0),o.hazardous?(d(),u("span",Ns,"Hazardous")):y("",!0),o.temperature_range||o.temperature_unit?(d(),u("span",Cs,[i[9]||(i[9]=t("span",{class:"font-medium"},"Temp:",-1)),t("span",null,c(o.temperature_range||"")+" "+c(o.temperature_unit||""),1)])):y("",!0),o.volume!=null?(d(),u("span",Ls,[i[10]||(i[10]=t("span",{class:"font-medium"},"Vol:",-1)),t("span",null,c(o.volume),1)])):y("",!0),o.delivery_status?(d(),u("span",Is,[i[11]||(i[11]=t("span",{class:"font-medium"},"Status:",-1)),t("span",null,c(w(o.delivery_status)),1)])):y("",!0)])]),t("div",Ps,[ie(o)?(d(),je(Oe,{key:0,class:"w-full h-full",dimensions:h(o),"show-dimensions":!1,size:k(o),"scale-mode":"absolute","fit-reference":O.value},null,8,["dimensions","size","fit-reference"])):y("",!0)])]))),128))])])):(d(),u("div",zs,[t("div",qs,[i[12]||(i[12]=t("div",{class:"font-semibold text-sm"},"Package Details",-1)),a.request.dimensions?(d(),u("div",Fs,c(a.request.dimensions),1)):(d(),u("div",As,"Loading real package details…"))]),a.request.dimensions?(d(),u("div",Rs,[H(Oe,{class:"w-full h-full",dimensions:le.value,"show-dimensions":!1,size:ye(),"scale-mode":"absolute","fit-reference":O.value},null,8,["dimensions","size","fit-reference"])])):(d(),u("div",Ds,[...i[13]||(i[13]=[t("svg",{class:"animate-spin",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 12a9 9 0 1 1-6.219-8.56","stroke-linecap":"round"})],-1)])]))])),t("div",Ks,[t("div",Es,[H(q(ht),{class:"w-3.5 h-3.5"}),t("span",Ts,"Expires in "+c(N.value),1)])]),(a.request.feeKr||0)>0?(d(),u("div",Vs,[t("div",js,c(Math.round(a.request.feeKr))+" kr",1),i[14]||(i[14]=t("div",{class:"text-xs text-green-600"},"delivery fee",-1))])):y("",!0)]),t("footer",Gs,[t("button",{class:"h-10 px-4 tap-target rounded-lg border bg-white hover:bg-gray-50 flex-1 flex items-center justify-center gap-1.5 font-medium text-gray-700",onClick:Q},[H(q(We),{class:"w-3.5 h-3.5"}),i[15]||(i[15]=t("span",null,"Decline",-1))]),a.deliveryId!=null&&(a.packages?.length||0)>0?(d(),u("button",{key:0,class:"h-10 px-4 tap-target rounded-lg bg-green-600 text-white hover:bg-green-700 flex-1 disabled:opacity-60 flex items-center justify-center gap-1.5 font-medium",disabled:D.value,onClick:ee},[H(q(Ue),{class:"w-3.5 h-3.5"}),i[16]||(i[16]=t("span",null,"Accept all",-1))],8,Bs)):y("",!0),t("button",{class:"h-10 px-4 tap-target rounded-lg border bg-white text-gray-800 hover:bg-gray-50 flex-1 disabled:opacity-60 flex items-center justify-center gap-1.5 font-medium",disabled:D.value,onClick:z},[H(q(Ue),{class:"w-3.5 h-3.5"}),i[17]||(i[17]=t("span",null,"Accept",-1))],8,Ws)])])])])):y("",!0)]))}}),De="new-pickup-request";function Hs(Z){window.dispatchEvent(new CustomEvent(De,{detail:Z}))}function Os(Z){const b=_=>{Z(_.detail)};return window.addEventListener(De,b),()=>window.removeEventListener(De,b)}function Js(Z){const b=V(null),_=V(!1),R=V(null),K=V(null);let D=null;const N=async r=>{};function m(){if(!("geolocation"in navigator)){R.value="Geolocation not supported by this browser.";return}D==null&&(_.value=!0,D=navigator.geolocation.watchPosition(r=>{const C=r.coords.speed!=null&&Number.isFinite(r.coords.speed)?Math.max(0,r.coords.speed*3.6):null,z={lat:r.coords.latitude,lng:r.coords.longitude,accuracy_m:r.coords.accuracy??void 0,heading_deg:r.coords.heading??null,speed_kph:C,timestamp:r.timestamp};b.value=z,N()},r=>{R.value=r?.message||"Unable to get location",_.value=!1},{enableHighAccuracy:!0,timeout:15e3,maximumAge:5e3}))}function E(){if(D!=null){try{navigator.geolocation.clearWatch(D)}catch{}D=null}_.value=!1}return _e(()=>E()),{position:b,active:_,error:R,lastSentAt:K,start:m,stop:E}}const Ys={},Qs={class:"space-y-6"},Xs={class:"rounded-xl border bg-white shadow-sm"},Zs={class:"p-4 border-b flex items-center justify-between flex-wrap gap-2"},en={class:"flex items-center gap-2 flex-wrap"},tn=["disabled"],sn=["disabled"],nn={class:"p-4"},an={class:"rounded-xl border bg-white shadow-sm"},ln={class:"p-4 border-b flex items-center justify-between"},on={key:0,class:"text-xs text-gray-500"},rn={class:"flex items-center gap-2"},dn=["disabled"],un=["disabled"],cn={key:0,class:"p-4"},vn={class:"text-sm text-red-600"},mn={key:1,class:"p-4 space-y-3"},pn={key:0,class:"text-sm text-gray-500"},fn={key:1,class:"text-sm text-gray-500"},hn={key:2,class:"grid gap-3"},gn={class:"flex items-center justify-between gap-3 flex-wrap"},yn=["onClick"],xn={class:"flex items-center gap-3 flex-wrap"},bn={key:0,class:"text-xs text-gray-500"},_n={key:0},kn={key:1},wn={key:2},$n=["onClick"],Mn=["disabled","onClick"],Sn={class:"mt-1 grid gap-2 md:grid-cols-2 text-sm"},Nn={class:"font-medium break-words"},Cn={class:"font-medium break-words"},Ln={class:"mt-3"},In={class:"space-y-2"},Pn={class:"text-sm flex-1"},zn={class:"font-medium"},qn={key:0,class:"text-gray-500"},Fn={key:1,class:"ml-2 inline-flex items-center gap-1 text-green-700 text-xs"},An={class:"mt-1 flex flex-wrap gap-2 text-sm sm:text-xs"},Rn={key:0,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-100 text-gray-700"},Dn={key:1,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-100 text-gray-700"},Kn={key:2,class:"inline-flex items-center px-2 py-0.5 rounded bg-amber-100 text-amber-800"},En={key:3,class:"inline-flex items-center px-2 py-0.5 rounded bg-red-100 text-red-800"},Tn={key:4,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-blue-50 text-blue-700"},Vn={key:5,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-purple-50 text-purple-700"},jn={key:6,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-green-50 text-green-700"},Gn={key:0,class:"pt-2 sm:pt-1"},Bn=["disabled","onClick"],Wn={key:0,class:"mt-2 text-xs text-gray-500"},Un={key:3,class:"mt-2 pt-3 border-t text-sm"},Hn={class:"flex items-center gap-2"},On=["disabled"],Jn={key:4,class:"mt-2 pt-3 border-t text-xs text-gray-500"},ta=Ke({__name:"ActiveDeliveriesView",setup(Z){const{future:b,loading:_,error:R,loadFuture:K,refresh:D}=rt(),N=V([]),m=V(!1),E=V(null),r=V({}),C=ze({}),z=V(null),Q=V(null),ee=V(null),te=V(null),B=ze(new Set),ae=ze(new Set),le=v(()=>r.value.lat!=null&&r.value.lng!=null?`Using location: ${r.value.lat.toFixed(4)}, ${r.value.lng.toFixed(4)}`:"Showing suggestions without precise location"),ye=Number(Ys?.VITE_NEARBY_REFRESH_MS??6e4);let O=null;function ie(){O==null&&(O=window.setInterval(()=>{m.value||a()},Math.max(5e3,ye)))}function J(){O!=null&&(clearInterval(O),O=null)}function oe(){document.hidden?J():ie()}const h=v(()=>!0),k=v(()=>{if(r.value.lat!=null&&r.value.lng!=null)return{lat:r.value.lat,lng:r.value.lng};const s=N.value.find(n=>n.pickup_lat!=null&&n.pickup_lng!=null);if(s&&s.pickup_lat!=null&&s.pickup_lng!=null)return{lat:s.pickup_lat,lng:s.pickup_lng};const e=Object.values(C);return e.length>0?e[0]:{lat:59.9139,lng:10.7522}}),w=v(()=>{const s=[];r.value.lat!=null&&r.value.lng!=null&&s.push({lat:r.value.lat,lng:r.value.lng,label:"You are here",kind:"user"});for(const e of b.value||[]){const n=e.pickup_location||e.delivery?.delivery_location||e.location,l=`job:${n||e.date||""}:${e.time||""}`,p=l?C[l]:void 0;p&&s.push({id:l,lat:p.lat,lng:p.lng,label:`Job ${e.delivery?.id?"#"+e.delivery.id:""} ${n?"— "+n:""}`.trim(),kind:"job"})}for(const e of N.value)e.pickup_lat!=null&&e.pickup_lng!=null&&s.push({id:e.delivery_id,lat:e.pickup_lat,lng:e.pickup_lng,label:`Delivery #${e.delivery_id}`,kind:"nearby"});return s});async function a(){m.value=!0,E.value=null;try{const s=await pt(),e=[],n=[],l=new Set;for(const f of s){const P=f.pickup_latitude,j=f.pickup_longitude,U=typeof P=="string"?parseFloat(P):typeof P=="number"?P:void 0,M=typeof j=="string"?parseFloat(j):typeof j=="number"?j:void 0,T=(f.packages||[]).filter(S=>String(S.delivery_status||"").toLowerCase()==="ready_for_pickup").map(S=>({id:S.id,description:S.description,weight:S.weight,weight_unit:S.weight_unit,length:S.length,width:S.width,height:S.height,dimension_unit:S.dimension_unit,fragile:S.fragile,hazardous:S.hazardous,temperature_range:S.temperature_range,temperature_unit:S.temperature_unit,volume:S.volume??S.volume_liters,delivery_status:S.delivery_status})),G={delivery_id:f.delivery_id,uuid:f.uuid,pickup_location:f.pickup_location,delivery_location:f.delivery_location,receiver_name:f.receiver_name,receiver_phone:f.receiver_phone,service:f.service,price:f.price,pickup_lat:Number.isFinite(U)?U:void 0,pickup_lng:Number.isFinite(M)?M:void 0,packages:T};let ne=!1;for(const S of T)S?.id!=null&&(l.add(S.id),!ae.has(S.id)&&!B.has(S.id)&&(ne=!0));ne&&n.push(G),e.push(G)}N.value=e,ae.clear(),l.forEach(f=>ae.add(f)),F.value&&!L.value&&n.length>0&&st(n[0]);const p=e.reduce((f,P)=>f+(P.packages?.length||0),0);be(p);for(const f of N.value)if((f.pickup_lat==null||f.pickup_lng==null)&&f.pickup_location){const P=await He(f.pickup_location);P&&(f.pickup_lat=P.lat,f.pickup_lng=P.lng)}}catch(s){E.value=s?.message||"Failed to load nearby assignments",N.value=[],be(0)}finally{m.value=!1}}function i(s){z.value=s}function o(){ue(),a()}async function I(s){ee.value=s;try{await Be(s),B.add(s),setTimeout(()=>B.delete(s),4e3),await Promise.allSettled([D(),a()]),$e(b.value?.length||0);const e=N.value.reduce((n,l)=>n+(l.packages?.length||0),0);be(e)}catch(e){E.value=e?.message||"Failed to accept assignment"}finally{ee.value=null}}async function g(s){const e=N.value.find(n=>n.delivery_id===s);if(!(!e||!e.packages?.length)){te.value=s;try{for(const l of e.packages)try{await Be(l.id),B.add(l.id),setTimeout(()=>B.delete(l.id),4e3)}catch(p){const f=p?.message||"Failed to accept a package";E.value=f}await Promise.allSettled([D(),a()]),$e(b.value?.length||0);const n=N.value.reduce((l,p)=>l+(p.packages?.length||0),0);be(n)}finally{te.value=null}}}function $(){Q.value!=null&&I(Q.value)}const F=v(()=>(b.value?.length||0)>0),L=V(!1),x=V({priority:"standard",pickup:{name:"",address:""},dropoff:{name:"",address:""},etaMinutes:0,distanceKm:0,dimensions:"",weightKg:0,volumeL:0,feeKr:0,expiresInSeconds:0});let A=null;const W=Os(s=>{A!=null&&(clearTimeout(A),A=null);let e=s,n=0;const l=()=>{n+=1;const p=ce(e);if(p&&Array.isArray(p.packages)&&p.packages.filter(P=>!B.has(P.id)).length>0){e.deliveryId==null&&(e={...e,deliveryId:p.delivery_id}),e=Pe(e,p),x.value=e,L.value=!0,A=null;return}if(n>=10){A=null;return}A=window.setTimeout(l,300)};l()});_e(()=>W()),_e(()=>{document.removeEventListener("visibilitychange",oe),J()}),_e(()=>{A!=null&&(clearTimeout(A),A=null)}),dt(async()=>{const s=K();a(),await s,await se(),$e(b.value?.length||0),ue(),ie(),document.addEventListener("visibilitychange",oe)});async function X(){await Promise.allSettled([K()]),await se(),await a(),$e(b.value?.length||0);const s=N.value.reduce((e,n)=>e+(n.packages?.length||0),0);be(s)}function re(s){console.log("Accepted pickup",s)}function de(s){console.log("Declined pickup",s)}function pe(s){console.log("Pickup expired",s)}function Y(s){return`job:${s.pickup_location||s.delivery?.delivery_location||s.location||s.date||""}:${s.time||""}`}async function se(){for(const s of b.value||[]){const e=Y(s);if(!e||C[e])continue;const n=s.pickup_location||s.delivery?.delivery_location||s.location;if(!n)continue;const l=await He(n);l&&(C[e]=l)}}const{position:fe,error:he,start:ue}=Js();Me(fe,s=>{s&&(r.value={lat:s.lat,lng:s.lng})}),Me(he,s=>{s&&(E.value=s)});function ce(s){const e=s??x.value;if(!e)return;if(e.deliveryId!=null)return N.value.find(M=>M.delivery_id===e.deliveryId);const n=M=>(M||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim(),l=M=>new Set(n(M).split(" ").filter(T=>T.length>2)),p=(M,T)=>{if(!M.size||!T.size)return 0;let G=0;for(const ne of M)T.has(ne)&&G++;return G/(M.size+T.size-G)},f=l(e.pickup?.address),P=l(e.dropoff?.address);let j,U=0;for(const M of N.value){const T=l(M.pickup_location),G=l(M.delivery_location),ne=f.size?p(f,T):0,S=P.size?p(P,G):0,xe=n(M.pickup_location),Te=n(M.delivery_location),ke=n(e.pickup?.address),we=n(e.dropoff?.address),nt=(ke&&xe.includes(ke)||ke&&ke.includes(xe)?.2:0)+(we&&Te.includes(we)||we&&we.includes(Te)?.2:0),Ve=(ne+S)/2+nt;Ve>U&&(U=Ve,j=M)}if(U<.15){if(N.value.length===0)return;const M=G=>G?.pickup_lat!=null&&G?.pickup_lng!=null,T=r.value;if(T?.lat!=null&&T?.lng!=null&&N.value.some(M)){let G=N.value.find(M),ne=1/0;for(const S of N.value){if(!M(S))continue;const xe=Ee(T.lat,T.lng,S.pickup_lat,S.pickup_lng);xe<ne&&(ne=xe,G=S)}return G}return N.value[0]}return j}const ve=v(()=>ce()?.packages||[]),Ce=v(()=>x.value?.deliveryId??ce()?.delivery_id);function me(s){if(s==null)return null;const e=typeof s=="string"?s.replace(/,(?=\d)/g,".").trim():s,n=typeof e=="number"?e:parseFloat(String(e));return Number.isFinite(n)?n:null}function Le(s,e){const n=(e||"").toLowerCase();return n==="g"||n==="gram"||n==="grams"?s/1e3:n==="lb"||n==="lbs"||n==="pound"||n==="pounds"?s*.453592:s}function Ie(s){const e=me(s?.length),n=me(s?.width),l=me(s?.height);if(e==null||n==null||l==null)return null;const p=(s?.dimension_unit||"").toLowerCase(),f=M=>p==="mm"?M/10:p==="m"?M*100:p==="in"||p==="inch"||p==="inches"?M*2.54:M,P=f(e),j=f(n),U=f(l);return P*j*U/1e3}function Ye(s){for(const e of s?.packages||[])if(e?.length!=null&&e?.width!=null&&e?.height!=null){const n=e.dimension_unit||"cm";return`${e.length} × ${e.width} × ${e.height} ${n}`}return null}function Qe(s){let e=0,n=!1;for(const l of s?.packages||[]){const p=me(l?.weight);p!=null&&(e+=Le(p,l?.weight_unit),n=!0)}return n?Math.max(0,e):null}function Xe(s){let e=0,n=!1;for(const l of s?.packages||[]){const p=me(l?.volume),f=p??Ie(l);f!=null&&(e+=f,n=!0)}return n?Math.max(0,e):null}function Ze(s){if(!s)return null;const e=s.replace(/[^0-9,\.]/g,"").replace(/,(?=\d{2}\b)/,".").match(/\d+(?:\.\d+)?/);return e?parseFloat(e[0]):null}function et(s){return String(s||"").replace(/_/g," ")}function Ee(s,e,n,l){const p=M=>M*Math.PI/180,P=p(n-s),j=p(l-e),U=Math.sin(P/2)**2+Math.cos(p(s))*Math.cos(p(n))*Math.sin(j/2)**2;return 2*6371*Math.asin(Math.sqrt(U))}function Pe(s,e){const n={...s};e?.pickup_location&&(n.pickup={name:e?.receiver_name||n.pickup?.name||"Pickup",address:e.pickup_location}),e?.delivery_location&&(n.dropoff={name:e?.receiver_name||n.dropoff?.name||"Receiver",address:e.delivery_location});const l=Ye(e);l&&(n.dimensions=l);const p=Qe(e);p!=null&&(n.weightKg=Math.round(p*10)/10);const f=Xe(e);f!=null&&(n.volumeL=Math.round(f));const P=Ze(e?.price);if(P!=null&&(n.feeKr=Math.round(P)),r.value?.lat!=null&&r.value?.lng!=null&&e?.pickup_lat!=null&&e?.pickup_lng!=null){const j=Ee(r.value.lat,r.value.lng,e.pickup_lat,e.pickup_lng);n.distanceKm=Math.round(j*10)/10;const U=25;n.etaMinutes=Math.max(1,Math.round(j/U*60))}return n}function tt(s){const e={...s};return e.priority=e.priority||"standard",e.pickup={name:e.pickup?.name||"Pickup",address:e.pickup?.address||"Unknown pickup location"},e.dropoff={name:e.dropoff?.name||"Receiver",address:e.dropoff?.address||"Unknown delivery location"},e.distanceKm=Number.isFinite(e.distanceKm)&&e.distanceKm>0?Math.round(e.distanceKm*10)/10:1,e.etaMinutes=Number.isFinite(e.etaMinutes)&&e.etaMinutes>0?Math.round(e.etaMinutes):10,e.dimensions=e.dimensions||"Not specified",e.weightKg=Number.isFinite(e.weightKg)&&e.weightKg>=0?Math.round(e.weightKg*10)/10:0,e.volumeL=Number.isFinite(e.volumeL)&&e.volumeL>=0?Math.round(e.volumeL):0,e.feeKr=Number.isFinite(e.feeKr)&&e.feeKr>=0?Math.round(e.feeKr):0,e.expiresInSeconds=Number.isFinite(e.expiresInSeconds)&&e.expiresInSeconds>0?Math.round(e.expiresInSeconds):180,e}function st(s){if(!s)return;let e={priority:"standard",pickup:{name:s.receiver_name||"Pickup",address:s.pickup_location||"Unknown pickup location"},dropoff:{name:s.receiver_name||"Receiver",address:s.delivery_location||"Unknown delivery location"},etaMinutes:10,distanceKm:1,dimensions:"",weightKg:0,volumeL:0,feeKr:0,expiresInSeconds:180,deliveryId:s.delivery_id};e=Pe(e,s);const n=tt(e);Hs(n)}return Me([L,N],()=>{if(L.value&&x.value&&x.value.deliveryId==null){const s=ce();s&&(x.value=Pe({...x.value,deliveryId:s.delivery_id},s))}}),(s,e)=>(d(),u("section",Qs,[e[15]||(e[15]=t("h2",{class:"text-2xl font-semibold"},"Jobs & Nearby",-1)),t("section",Xs,[t("header",Zs,[e[4]||(e[4]=ut('<div><h3 class="text-lg font-semibold">Map</h3><div class="mt-1 text-xs text-gray-500 flex items-center gap-4"><span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-green-600"></span> Jobs</span><span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-blue-600"></span> Nearby</span><span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-gray-800"></span> You</span></div></div>',1)),t("div",en,[t("button",{class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:m.value,onClick:o},c(m.value?"Locating…":"Use my location"),9,tn),t("button",{class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:m.value,onClick:e[0]||(e[0]=n=>a())},"Refresh",8,sn)])]),t("div",nn,[H(ft,{center:k.value,markers:w.value,openMarkerId:z.value,height:"280px"},null,8,["center","markers","openMarkerId"])])]),H(mt,{items:q(b)||[],loading:q(_),error:q(R),showFullView:!0,enableActions:!0,title:"Your Jobs",onRefresh:X},null,8,["items","loading","error"]),t("section",an,[t("header",ln,[t("div",null,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold"},"Nearby Assignments",-1)),le.value?(d(),u("p",on,c(le.value),1)):y("",!0)]),t("div",rn,[t("button",{class:"h-8 px-3 rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:m.value,onClick:o},c(m.value?"Locating…":"Use my location"),9,dn),t("button",{class:"h-8 px-3 rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:m.value,onClick:e[1]||(e[1]=n=>a())},"Refresh",8,un)])]),E.value?(d(),u("div",cn,[t("div",vn,c(E.value),1)])):(d(),u("div",mn,[m.value?(d(),u("div",pn,"Loading nearby assignments…")):N.value.length===0?(d(),u("div",fn,"No nearby assignments right now.")):(d(),u("div",hn,[(d(!0),u(Ne,null,Re(N.value,n=>(d(),u("div",{key:n.delivery_id,class:"rounded-lg border p-3"},[t("div",gn,[t("div",{class:"text-sm font-semibold cursor-pointer hover:underline",onClick:Ge(l=>i(n.delivery_id),["stop"])},"Delivery #"+c(n.delivery_id),9,yn),t("div",xn,[n.service||n.price?(d(),u("div",bn,[n.service?(d(),u("span",_n,c(n.service),1)):y("",!0),n.service&&n.price?(d(),u("span",kn," • ")):y("",!0),n.price?(d(),u("span",wn,c(n.price),1)):y("",!0)])):y("",!0),t("button",{class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50 text-sm",onClick:Ge(l=>i(n.delivery_id),["stop"])}," Show on map ",8,$n),h.value?(d(),u("button",{key:1,class:"h-8 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50 text-sm",disabled:te.value===n.delivery_id||n.packages.length===0,onClick:l=>g(n.delivery_id)},c(te.value===n.delivery_id?"Accepting all…":"Accept all"),9,Mn)):y("",!0)])]),t("div",Sn,[t("div",null,[e[6]||(e[6]=t("div",{class:"text-gray-500"},"Pickup",-1)),t("div",Nn,c(n.pickup_location||"—"),1)]),t("div",null,[e[7]||(e[7]=t("div",{class:"text-gray-500"},"Delivery",-1)),t("div",Cn,c(n.delivery_location||"—"),1)])]),t("div",Ln,[e[14]||(e[14]=t("div",{class:"text-xs text-gray-500 mb-1"},"Packages",-1)),t("ul",In,[(d(!0),u(Ne,null,Re(n.packages,l=>(d(),u("li",{key:l.id,class:Ae(["flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",{"bg-green-50 border border-green-200 rounded":B.has(l.id)}])},[t("div",Pn,[t("div",null,[t("span",zn,"#"+c(l.id),1),l.description?(d(),u("span",qn," — "+c(l.description),1)):y("",!0),B.has(l.id)?(d(),u("span",Fn,[...e[8]||(e[8]=[t("span",{class:"inline-block h-1.5 w-1.5 rounded-full bg-green-600"},null,-1),Se(" Accepted ",-1)])])):y("",!0)]),t("div",An,[l.weight!=null?(d(),u("span",Rn,[e[9]||(e[9]=t("span",{class:"font-medium"},"Weight:",-1)),t("span",null,c(l.weight)+c(l.weight_unit||""),1)])):y("",!0),l.length!=null&&l.width!=null&&l.height!=null?(d(),u("span",Dn,[e[10]||(e[10]=t("span",{class:"font-medium"},"Size:",-1)),t("span",null,c(l.length)+" × "+c(l.width)+" × "+c(l.height)+" "+c(l.dimension_unit||""),1)])):y("",!0),l.fragile?(d(),u("span",Kn,"Fragile")):y("",!0),l.hazardous?(d(),u("span",En,"Hazardous")):y("",!0),l.temperature_range||l.temperature_unit?(d(),u("span",Tn,[e[11]||(e[11]=t("span",{class:"font-medium"},"Temp:",-1)),t("span",null,c(l.temperature_range||"")+" "+c(l.temperature_unit||""),1)])):y("",!0),l.volume!=null?(d(),u("span",Vn,[e[12]||(e[12]=t("span",{class:"font-medium"},"Vol:",-1)),t("span",null,c(l.volume),1)])):y("",!0),l.delivery_status?(d(),u("span",jn,[e[13]||(e[13]=t("span",{class:"font-medium"},"Status:",-1)),t("span",null,c(et(l.delivery_status)),1)])):y("",!0)])]),h.value?(d(),u("div",Gn,[B.has(l.id)?y("",!0):(d(),u("button",{key:0,class:"h-8 px-3 tap-target rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",disabled:ee.value===l.id||te.value===n.delivery_id,onClick:p=>I(l.id)},c(ee.value===l.id?"Accepting…":"Accept"),9,Bn))])):y("",!0)],2))),128))]),h.value?y("",!0):(d(),u("div",Wn," Accepting assignments is not configured on this server. "))])]))),128))])),h.value?(d(),u("div",Un,[t("div",Hn,[ct(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=n=>Q.value=n),class:"h-9 px-3 rounded border w-40",placeholder:"Package ID"},null,512),[[vt,Q.value,void 0,{number:!0}]]),t("button",{class:"h-9 px-3 tap-target rounded border bg-white hover:bg-gray-50 disabled:opacity-50",disabled:!Q.value||ee.value===Q.value,onClick:$},"Accept by ID",8,On)])])):(d(),u("div",Jn," To enable accepting, set VITE_ASSIGN_ENDPOINT to the correct endpoint path. "))]))]),H(Us,{modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=n=>L.value=n),request:x.value,packages:ve.value,deliveryId:Ce.value,onAccept:re,onDecline:de,onExpired:pe,onAcceptAll:g},null,8,["modelValue","request","packages","deliveryId"])]))}});export{ta as default};
